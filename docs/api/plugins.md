# Plugin API

Learn how to create and use plugins to extend VuePress functionality.

## What are Plugins?

Plugins allow you to add features and modify the behavior of your VuePress site without editing core code.

## Using Plugins

### Installation

Install plugins via npm:

```bash
npm install -D @vuepress/plugin-search@next
npm install -D @vuepress/plugin-pwa@next
```

### Configuration

Add plugins to your config file:

```js
import { searchPlugin } from '@vuepress/plugin-search'
import { pwaPlugin } from '@vuepress/plugin-pwa'

export default {
  plugins: [
    searchPlugin({
      // options
    }),
    pwaPlugin({
      // options
    }),
  ]
}
```

## Official Plugins

### Search Plugin

Add search functionality:

```js
import { searchPlugin } from '@vuepress/plugin-search'

plugins: [
  searchPlugin({
    maxSuggestions: 10,
    hotKeys: ['s', '/'],
    locales: {
      '/': {
        placeholder: 'Search',
      }
    }
  })
]
```

### Google Analytics

Track site analytics:

```js
import { googleAnalyticsPlugin } from '@vuepress/plugin-google-analytics'

plugins: [
  googleAnalyticsPlugin({
    id: 'G-XXXXXXXXXX'
  })
]
```

### PWA Plugin

Make your site a Progressive Web App:

```js
import { pwaPlugin } from '@vuepress/plugin-pwa'

plugins: [
  pwaPlugin({
    skipWaiting: true,
  })
]
```

### Container Plugin

Create custom containers:

```js
import { containerPlugin } from '@vuepress/plugin-container'

plugins: [
  containerPlugin({
    type: 'tip',
    before: (info) => `<div class="tip">${info}`,
    after: () => '</div>',
  })
]
```

## Creating Plugins

### Basic Plugin Structure

```js
// my-plugin.js
export default (options) => {
  return {
    name: 'my-plugin',

    // Plugin hooks
    onInitialized(app) {
      console.log('VuePress app initialized')
    },

    extendsPage(page) {
      // Modify page data
      page.data.customField = 'value'
    },

    onGenerated(app) {
      // After site generation
    }
  }
}
```

### Using Your Plugin

```js
import myPlugin from './my-plugin.js'

export default {
  plugins: [
    myPlugin({
      // options
    })
  ]
}
```

## Plugin Hooks

### onInitialized

Called when VuePress app is initialized.

```js
onInitialized(app) {
  console.log('Site pages:', app.pages.length)
}
```

### onPrepared

Called after page data is prepared.

```js
async onPrepared(app) {
  // Write custom data files
  await app.writeTemp(
    'my-data.js',
    `export const data = ${JSON.stringify(myData)}`
  )
}
```

### extendsPage

Modify page data before processing.

```js
extendsPage(page) {
  // Add reading time
  page.data.readingTime = calculateReadingTime(page.content)
}
```

### onGenerated

Called after static files are generated.

```js
async onGenerated(app) {
  // Generate sitemap, RSS feed, etc.
}
```

### extendsBundlerOptions

Modify bundler configuration.

```js
extendsBundlerOptions(options, app) {
  // Modify Vite or Webpack options
}
```

### extendsMarkdown

Extend markdown-it:

```js
extendsMarkdown(md) {
  md.use(require('markdown-it-footnote'))
}
```

## Plugin Options

### Defining Options

```js
export default (options = {}) => {
  const {
    enabled = true,
    message = 'Hello'
  } = options

  return {
    name: 'my-plugin',

    onInitialized() {
      if (enabled) {
        console.log(message)
      }
    }
  }
}
```

### TypeScript Support

```ts
import type { Plugin } from '@vuepress/core'

export interface MyPluginOptions {
  enabled?: boolean
  message?: string
}

export const myPlugin = (options: MyPluginOptions = {}): Plugin => {
  return {
    name: 'my-plugin',
    // ...
  }
}
```

## Advanced Examples

### Adding Global Components

```js
import { getDirname, path } from '@vuepress/utils'

const __dirname = getDirname(import.meta.url)

export default {
  name: 'component-plugin',

  clientConfigFile: path.resolve(__dirname, './client.js'),
}
```

```js
// client.js
import { defineClientConfig } from '@vuepress/client'
import MyComponent from './components/MyComponent.vue'

export default defineClientConfig({
  enhance({ app }) {
    app.component('MyComponent', MyComponent)
  }
})
```

### Generating Custom Pages

```js
export default {
  name: 'custom-pages-plugin',

  async onInitialized(app) {
    app.pages.push(
      await createPage(app, {
        path: '/custom-page/',
        content: '# Custom Page\n\nGenerated by plugin',
      })
    )
  }
}
```

### Adding Client Code

```js
export default {
  name: 'analytics-plugin',

  clientConfigFile: path.resolve(__dirname, './client.js'),
}
```

```js
// client.js
export default {
  setup() {
    if (typeof window !== 'undefined') {
      // Add analytics tracking code
      window.dataLayer = window.dataLayer || []
    }
  }
}
```

## Best Practices

1. **Name your plugin descriptively** - Use `vuepress-plugin-*` format
2. **Provide TypeScript types** - Help users with autocomplete
3. **Document options** - Clear documentation helps adoption
4. **Handle errors gracefully** - Don't crash the build
5. **Test thoroughly** - Test in both dev and build modes
6. **Keep it focused** - One plugin, one purpose
7. **Make it configurable** - Provide sensible defaults

## Community Plugins

Popular community plugins:

- `vuepress-plugin-sitemap` - Generate sitemap.xml
- `vuepress-plugin-feed` - Generate RSS/Atom feeds
- `vuepress-plugin-reading-time` - Add reading time estimates
- `vuepress-plugin-copyright` - Add copyright notices
- `vuepress-plugin-code-copy` - Add copy buttons to code blocks

## Debugging Plugins

Enable debug logging:

```bash
DEBUG=vuepress:plugin:* vuepress dev docs
```

Log plugin lifecycle:

```js
export default {
  name: 'my-plugin',

  onInitialized() {
    console.log('[my-plugin] initialized')
  },

  onPrepared() {
    console.log('[my-plugin] prepared')
  },

  onGenerated() {
    console.log('[my-plugin] generated')
  }
}
```

## See Also

- [Official Plugin List](https://v2.vuepress.vuejs.org/reference/plugin/)
- [Plugin Development Guide](/tutorials/plugin-development.html)
- [Core API Reference](/api/core.html)
